// Safe helper to run npx during settings evaluation.
// Place at the top so other logic can test for npx availability.
def safeRunNpx(List args) {
    try {
        def stdout = new ByteArrayOutputStream()
        def stderr = new ByteArrayOutputStream()
        def result = exec {
            commandLine = ['npx'] + args
            standardOutput = stdout
            errorOutput = stderr
            ignoreExitValue = true
        }
        def outText = stdout.toString().trim()
        def errText = stderr.toString().trim()
        if (result.exitValue != 0) {
            println "Warning: npx ${args.join(' ')} exited ${result.exitValue}; stderr: ${errText}"
            return null
        }
        return outText
    } catch (Exception e) {
        println "Warning: failed to run npx: ${e.message}"
        return null
    }
}

// Check whether npx is available (returns non-null if available)
def npxAvailable() {
    return safeRunNpx(['--version']) != null
}

// Plugin/includeBuild (only include once)
pluginManagement { includeBuild("../node_modules/@react-native/gradle-plugin") }
plugins { id("com.facebook.react.settings") }

// If npx is available, run autolink; otherwise warn and continue (avoid failing settings evaluation)
if (npxAvailable()) {
    extensions.configure(com.facebook.react.ReactSettingsExtension){ ex -> ex.autolinkLibrariesFromCommand() }
} else {
    println "Warning: npx not available â€” skipping autolinkLibrariesFromCommand(). Ensure Node is installed in CI or run autolinking separately."
}

rootProject.name = 'MapLocation'
include ':app'
includeBuild('../node_modules/@react-native/gradle-plugin')