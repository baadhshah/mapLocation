// IMPORTANT: pluginManagement must come before other statements.
// Include the RN gradle plugin build so the plugin can be applied.
pluginManagement {
    includeBuild("../node_modules/@react-native/gradle-plugin")
}
plugins {
    id("com.facebook.react.settings")
}

// Safer wrapper to run npx and return stdout or null on failure.
// We avoid failing the settings script if npx is missing or returns non-zero.
// Note: starting external processes during configuration is discouraged and
// may prevent configuration caching; prefer moving heavy logic to execution phase.
def safeRunNpx(List args) {
    try {
        def stdout = new ByteArrayOutputStream()
        def stderr = new ByteArrayOutputStream()
        def result = exec {
            commandLine = ['npx'] + args
            standardOutput = stdout
            errorOutput = stderr
            ignoreExitValue = true
        }
        def outText = stdout.toString().trim()
        def errText = stderr.toString().trim()
        if (result.exitValue != 0) {
            println "Warning: npx ${args.join(' ')} exited ${result.exitValue}; stderr: ${errText}"
            return null
        }
        return outText
    } catch (Exception e) {
        println "Warning: failed to run npx ${args.join(' ')}: ${e.message}"
        return null
    }
}

// Optionally attempt to run autolink only if npx is present and working.
// Replace or remove this block if you already move autolink elsewhere.
def nodeCheck = safeRunNpx(['--version'])
if (nodeCheck != null) {
    try {
        extensions.configure(com.facebook.react.ReactSettingsExtension) { ex ->
            ex.autolinkLibrariesFromCommand()
        }
    } catch (Exception e) {
        println "Warning: autolinkLibrariesFromCommand() raised: ${e.message}. Continuing without autolink."
    }
} else {
    println "Warning: npx not available or failed; skipping autolinkLibrariesFromCommand(). Ensure CI installs Node before Gradle."
}

rootProject.name = 'MapLocation'
include ':app'
